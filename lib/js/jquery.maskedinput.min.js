function getPasteEvent(){var e=document.createElement("input"),t="onpaste";e.setAttribute(t,"");return typeof e[t]==="function"?"paste":"input"}var pasteEventName=getPasteEvent()+".mask",ua=navigator.userAgent,iPhone=/iphone/i.test(ua),android=/android/i.test(ua),caretTimeoutId;$.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},dataName:"rawMaskFn",placeholder:"_"};$.fn.extend({caret:function(e,t){var n;if(this.length===0||this.is(":hidden")){return}if(typeof e=="number"){t=typeof t==="number"?t:e;return this.each(function(){if(this.setSelectionRange){this.setSelectionRange(e,t)}else if(this.createTextRange){n=this.createTextRange();n.collapse(true);n.moveEnd("character",t);n.moveStart("character",e);n.select()}})}else{if(this[0].setSelectionRange){e=this[0].selectionStart;t=this[0].selectionEnd}else if(document.selection&&document.selection.createRange){n=document.selection.createRange();e=0-n.duplicate().moveStart("character",-1e5);t=e+n.text.length}return{begin:e,end:t}}},unmask:function(){return this.trigger("unmask")},mask:function(e,t){var n,r,i,s,o,u;if(!e&&this.length>0){n=$(this[0]);return n.data($.mask.dataName)()}t=$.extend({placeholder:$.mask.placeholder,completed:null},t);r=$.mask.definitions;i=[];s=u=e.length;o=null;$.each(e.split(""),function(e,t){if(t=="?"){u--;s=e}else if(r[t]){i.push(new RegExp(r[t]));if(o===null){o=i.length-1}}else{i.push(null)}});return this.trigger("unmask").each(function(){function l(e){while(++e<u&&!i[e]);return e}function c(e){while(--e>=0&&!i[e]);return e}function h(e,r){var s,f;if(e<0){return}for(s=e,f=l(r);s<u;s++){if(i[s]){if(f<u&&i[s].test(a[f])){a[s]=a[f];a[f]=t.placeholder}else{break}f=l(f)}}g();n.caret(Math.max(o,e))}function p(e){var n,r,s,o;for(n=e,r=t.placeholder;n<u;n++){if(i[n]){s=l(n);o=a[n];a[n]=r;if(s<u&&i[s].test(o)){r=o}else{break}}}}function d(e){var t=e.which,r,i,s;if(t===8||t===46||iPhone&&t===127){r=n.caret();i=r.begin;s=r.end;if(s-i===0){i=t!==46?c(i):s=l(i-1);s=t===46?l(s):s}m(i,s);h(i,s-1);e.preventDefault()}else if(t==27){n.val(f);n.caret(0,y());e.preventDefault()}}function v(e){var r=e.which,s=n.caret(),o,f,c;if(e.ctrlKey||e.altKey||e.metaKey||r<32){return}else if(r){if(s.end-s.begin!==0){m(s.begin,s.end);h(s.begin,s.end-1)}o=l(s.begin-1);if(o<u){f=String.fromCharCode(r);if(i[o].test(f)){p(o);a[o]=f;g();c=l(o);if(android){setTimeout($.proxy($.fn.caret,n,c),0)}else{n.caret(c)}if(t.completed&&c>=u){t.completed.call(n)}}}e.preventDefault()}}function m(e,n){var r;for(r=e;r<n&&r<u;r++){if(i[r]){a[r]=t.placeholder}}}function g(){n.val(a.join(""))}function y(e){var r=n.val(),f=-1,l,c;for(l=0,pos=0;l<u;l++){if(i[l]){a[l]=t.placeholder;while(pos++<r.length){c=r.charAt(pos-1);if(i[l].test(c)){a[l]=c;f=l;break}}if(pos>r.length){break}}else if(a[l]===r.charAt(pos)&&l!==s){pos++;f=l}}if(e){g()}else if(f+1<s){n.val("");m(0,u)}else{g();n.val(n.val().substring(0,f+1))}return s?l:o}var n=$(this),a=$.map(e.split(""),function(e,n){if(e!="?"){return r[e]?t.placeholder:e}}),f=n.val();n.data($.mask.dataName,function(){return $.map(a,function(e,n){return i[n]&&e!=t.placeholder?e:null}).join("")});if(!n.attr("readonly"))n.one("unmask",function(){n.unbind(".mask").removeData($.mask.dataName)}).bind("focus.mask",function(){clearTimeout(caretTimeoutId);var t,r;f=n.val();t=y();caretTimeoutId=setTimeout(function(){g();if(t==e.length){n.caret(0,t)}else{n.caret(t)}},10)}).bind("blur.mask",function(){y();if(n.val()!=f)n.change()}).bind("keydown.mask",d).bind("keypress.mask",v).bind(pasteEventName,function(){setTimeout(function(){var e=y(true);n.caret(e);if(t.completed&&e==n.val().length)t.completed.call(n)},0)});y()})}})