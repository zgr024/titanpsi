var AccordionController=function(t,e){var i=this;i.itemClass="item",i.itemSelector="."+i.itemClass,i.items=[],i.props={},i.dimCache={},i.resize=_.debounce(_.bind(i._resize,i),200),i.activateSlide=_.debounce(function(t){i._activateSlide(t)},50),i.deactivateSlide=_.debounce(_.bind(i._deactivateSlide,i),300),i.activeSlideMouseOverlapDistance=10,i.minimumSliceWidth=30,i.problematicMinimumSliceWidth=0,AccordionController.super_.apply(i,arguments)};utils.inherits(AccordionController,SimpleAppProto),AccordionController.prototype.createDom=function(){var t,e,i,o=this,r=$("<div></div>").appendTo(o.el).addClass("elems");o.isMobile&&o.el.addClass("mobile"),o.displayNode=r,_.forEach(o.items,function(s){t=$("<div></div>").appendTo(r),$("<div></div>").appendTo(t).addClass("overlay"),e=$("<div></div>").appendTo(t).addClass("filler"),t.data("item",s).addClass(o.itemClass);var a=o.props.textMode;"noText"!==a&&(i=$("<div></div>").appendTo(e).addClass("details"),"titleOnly"!==a&&"titleAndDescription"!==a||$("<h3></h3>").appendTo(i).addClass("title").html(s.title),"descriptionOnly"!==a&&"titleAndDescription"!==a||$("<div></div>").appendTo(i).addClass("desc").html(s.description))});var s=0;o.isMobile?(r.hammer().on("drag",o.itemSelector,function(t){$(o.itemSelector,o.el).removeClass("active"),r.hammer().on("dragstart",function(t){s=$(o.el).get(0).scrollLeft}).on("drag",function(t){var e=t.gesture,i=o.el.get(0);return i.scrollLeft=s-e.deltaX,!1})}),r.hammer().on("tap",o.itemSelector,function(t){var e=$(this);o.itemClick(e.data("item"),e.index(),t)})):(r.on("mousemove mouseover mouseenter",o.itemSelector,function(t){o.mouseX=t.pageX,o.activateSlide(this)}),r.on("mouseleave",o.el,o.deactivateSlide),r.on("click",o.itemSelector,function(t){var e=$(this);o.itemClick(e.data("item"),e.index(),t)}))},AccordionController.prototype.itemClick=function(t,e,i){switch(this.props.galleryImageOnClickAction){case"zoomMode":Wix.pushState(JSON.stringify({cmd:"zoom",args:[e]}));break;case"disabled":case"goToLink":this.openLink(t.href,t.target,t.linkType,i,t["data-anchor"],this.mainPageId,t.link);break;default:this.deactivateSlide()}},AccordionController.prototype.updateLayout=function(t){var e=this,i=e.getViewportSize(),o=e.items.length,r=Math.floor(i.width/o),s=i.width-r*o+1,t=t===!0,a=0;$(e.el).width(i.width).height(i.height),e.isMobile&&($(".details").addClass("hide"),r=Math.floor(i.width/Math.min(o,4.5)),s=0,$(e.displayNode).css({overflow:"hidden",position:"relative"}).width(r*o),$(e.displayNode).css({touchAction:"auto"})),e.sliceWidth=r,e.trail=s;var l=0,d=$(e.itemSelector,e.el);d.each(function(){var o,d=$(this),n=d.data("item"),h=Math.min(i.height/n.height,2),c=Math.floor(n.width*h),p=e.dimCache[n.uri]||{width:0,height:0};if(i.height>p.height&&c>p.width&&(p={width:c,height:i.height}),(0===l||l>p.width)&&(l=p.width),e.dimCache[n.uri]=p,o=utils.getResizedImageUrl(n.uri,p.width,p.height,{siteQuality:e.quality,maxWidth:n.width,maxHeight:n.height}),s&&(r=e.sliceWidth+1,s--),$(".filler",d).css({backgroundImage:"url("+o+")",backgroundSize:"cover"}).height(i.height),t){var m={left:a,width:r};e.isMobile&&delete m.left,d.stop().animate(m,e.props.transitionDuration,e.props.easing)}else d.width(r).offset({left:a}),$(".filler",d).width(r);a+=r}).height(i.height);var n=(i.width-l)/(d.length-1);n!==this.problematicMinimumSliceWidth&&(this.problematicMinimumSliceWidth=n),t&&$(".filler",e.itemSelector).stop().animate({width:e.sliceWidth+1},e.props.transitionDuration,e.props.easing,function(){var t=$(this);e.trail&&t.index()<e.trail&&$(this).width(e.sliceWidth+1)}),$(e.el).css("text-align",e.props.alignText),"left"===e.props.alignText?$(".details",e.el).css({"margin-left":0,"margin-right":"10%"}):"right"===e.props.alignText?$(".details",e.el).css({"margin-left":"10%","margin-right":0}):$(".details",e.el).css({"margin-left":"10%","margin-right":"10%"});var h,c,p;$.support.opacity?(c=utils.hexToRgba(e.props.borderColor,e.props.alphaBorderColor),h=utils.hexToRgba(e.props.textBackgroundColor,e.props.alphaTextBackgroundColor)):(c=e.props.borderColor,h=e.props.textBackgroundColor),p=e.props.borderWidth+"px solid "+c,$(e.itemSelector,e.el).find(".details").css({backgroundColor:h}).stop().fadeTo(0,0),utils.loadGoogleFontIfNeeded(e.props.font),$(e.itemSelector,e.el).find(".title").css({fontFamily:utils.fontFamilyDegradation(e.props.font),color:e.props.textColor}).fadeTo(0,e.props.alphaTextColor),$(e.itemSelector,e.el).find(".desc").css({fontFamily:utils.fontFamilyDegradation(e.props.font),color:e.props.descriptionColor}).fadeTo(0,e.props.alphaDescriptionColor),t||($(e.itemSelector,e.el).css({borderRight:p}),$(e.itemSelector,e.el).css({width:e.sliceWidth+(e.isMobile?0:1)}),$(e.itemSelector,e.el).last().css({borderRight:0}))},AccordionController.prototype.destroy=function(){$(this.el).html("")},AccordionController.prototype.updateSettings=function(t){var e=!1;this.mainPageId=t.mainPageId,(this.itemsChanged(t.items,["uri","title","description"])||this.propsChanged(t.props,["textMode"]))&&(e=!0),e?(this.destroy(),this.items=t.items||[],this.props=t.props||{},this.createDom()):_.assign(this.props,t.props),this.quality=t.quality||{},this.props.borderWidth^=0,this.props.transitionDuration||(this.props.transitionDuration=600),this.props.easing||(this.props.easing="easeOutQuad"),this.updateLayout()},AccordionController.prototype._resize=function(){var t=$(this.itemSelector+".active",this.el),e=this.getViewportSize();t.length?($(this.el).width(e.width).height(e.height),$(this.itemSelector+" .filler, "+this.itemSelector,this.el).height(e.height),t.removeClass("active"),this.activateSlide(t.get(0))):this.updateLayout()},AccordionController.prototype._activateSlide=function(t){var e,i,o=this,r=$(t),s=r.data("item"),a=o.getViewportSize(),l=a.width+o.props.borderWidth,d=r.index(),n=0===d||d===o.items.length-1,h=a.height/s.height,c=Math.floor(s.width*h),p=c,m=Math.floor((l-p)/(o.items.length-1));r.is(".active")||(n||($(".overlay",r).css({backgroundColor:"#000000"}),o.mouseX<m*d?(m=Math.floor((o.mouseX-o.activeSlideMouseOverlapDistance)/d),p=l-m*(o.items.length-1)):o.mouseX>m*d+c?(m=Math.floor((l-o.mouseX-o.activeSlideMouseOverlapDistance)/(o.items.length-d-1)),p=l-m*(o.items.length-1)):o.mouseX>m*d&&o.mouseX<m*d+c),m<o.minimumSliceWidth&&(m=o.minimumSliceWidth,p=l-m*(o.items.length-1)),e=l-p-m*(o.items.length-1),i=0,p>c&&(m=this.problematicMinimumSliceWidth,p=l-m*(o.items.length-1)),$(".details:visible",o.itemSelector).stop().fadeTo(0,0),$(o.itemSelector,o.el).each(function(){var r=$(this),s=this===t,a=s?p:m,l=s?Math.min(c,p):m;e&&!s&&(a++,l++,e--),$(".filler",r).stop().animate({width:l},o.props.transitionDuration,o.props.easing),r.stop().animate({left:i,width:a},o.props.transitionDuration,o.props.easing,s?function(){$(".details",this).fadeTo(700,1)}:void 0),i+=a}).removeClass("active"),r.addClass("active"))},AccordionController.prototype._deactivateSlide=function(){return $(this.itemSelector,this.el).removeClass("active"),this.updateLayout(!0)},AccordionController.prototype.getViewportSize=function(){var t=document.documentElement;return{width:t.clientWidth,height:t.clientHeight}};